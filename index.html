<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tasks ‚Äî Telegram Mini App</title>

  <!-- Telegram Web App JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js' data-zone='9873868' data-sdk='show_9873868'></script>

  <style>
    :root{--accent:#ffb000;--bg:#0f0f10;--card:#131313;--muted:#9b9b9b;--white:#ffffff}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:#fff;display:flex;align-items:center;justify-content:center;height:100vh;padding:18px}
    .frame{width:380px;border-radius:20px;background:#ffb000;box-shadow:0 6px 0 rgba(0,0,0,0.06)}
    .device{background:var(--bg);border-radius:14px;overflow:hidden;padding-bottom:22px}
    header{padding:18px 18px 12px;color:var(--white)}
    header .top{display:flex;align-items:center;justify-content:space-between}
    .section-title{color:var(--white);font-size:28px;margin:8px 0}
    .subtitle{opacity:0.6;font-size:13px}
    main{padding:18px}
    .card{background:linear-gradient(0deg,#ffb000 0%,#ffb000 0%);padding:16px;border-radius:8px;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between}
    .card.dark{background:var(--card)}
    .btn{background:var(--white);color:var(--bg);padding:8px 14px;border-radius:22px;font-weight:600;border:none;cursor:pointer}
    .muted-card{background:var(--card);padding:18px;border-radius:8px;color:var(--white)}
    .small-row{display:flex;align-items:center;justify-content:space-between;margin-top:12px}
    .clock-badge{width:40px;height:40px;border-radius:50%;background:linear-gradient(180deg,#2b2b2b,#181818);display:flex;align-items:center;justify-content:center;color:#fff}
    #ad-debug{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.8);color:#fff;font-size:12px;max-height:120px;overflow-y:auto;padding:6px 10px;font-family:monospace;z-index:9999}
  </style>
</head>
<body>
  <div class="frame" role="application">
    <div class="device">
      <header>
        <div class="top">
          <div>Close</div>
          <h1>Your app</h1>
          <div>‚ãØ</div>
        </div>
        <div>
          <div class="section-title">Tasks</div>
          <div class="subtitle">Get rewards for actions</div>
        </div>
      </header>

      <main>
        <!-- In-App Chain -->
        <div class="muted-card">
          <div style="font-size:22px;margin-bottom:6px">Daily</div>
          <div style="color:var(--muted);font-size:13px;margin-bottom:14px">Endless Ads Chain</div>

          <div class="small-row">
            <div style="display:flex;align-items:center;gap:14px">
              <div class="emoji" style="font-size:36px">üëÄ</div>
              <div>
                <div class="title">Watch Ads</div>
                <div class="meta">Infinite Loop</div>
              </div>
            </div>
            <div style="display:flex;gap:8px">
              <button class="btn" id="btn-inapp">Watch</button>
              <button class="btn" id="btn-stop" style="display:none;background:#ff4d4d;color:#fff">Stop</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="ad-debug"></div>

  <script>
    const tg = window.Telegram?.WebApp || null;
    if (tg) tg.expand();

    function logDebug(msg){
      const div = document.getElementById('ad-debug');
      const time = new Date().toLocaleTimeString();
      div.innerHTML += `[${time}] ${msg}<br>`;
      div.scrollTop = div.scrollHeight;
      console.log(msg);
    }

    function rewardUser(source){
      logDebug('Rewarding user for ' + source);
      if (tg?.MainButton){
        tg.MainButton.setText(`Reward from ${source} üéâ`);
        tg.MainButton.show();
        setTimeout(()=>tg.MainButton.hide(), 1500);
      }
    }

    let adLoopRunning = false;

    async function startAdChain(){
      if (typeof show_9873868 !== 'function'){
        logDebug('SDK not loaded.');
        return;
      }

      if (adLoopRunning) return;
      adLoopRunning = true;
      document.getElementById('btn-stop').style.display = 'inline-block';

      async function chain(){
        if (!adLoopRunning) {
          logDebug('Ad loop stopped ‚ùå');
          return;
        }
        try {
          logDebug('Showing ad...');
          await show_9873868({ type: 'inApp' });
          logDebug('Ad closed ‚úÖ');
          rewardUser('Ad');
          chain(); // immediately show next
        } catch(e){
          logDebug('Ad error: ' + e);
          setTimeout(chain, 2000); // retry after 2s
        }
      }

      chain();
    }

    function stopAdChain(){
      adLoopRunning = false;
      document.getElementById('btn-stop').style.display = 'none';
      logDebug('User pressed Stop.');
    }

    document.getElementById('btn-inapp').addEventListener('click', startAdChain);
    document.getElementById('btn-stop').addEventListener('click', stopAdChain);
  </script>
</body>
</html>
