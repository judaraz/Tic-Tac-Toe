<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tasks ‚Äî Telegram Mini App</title>

  <!-- Telegram Web App JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Monetag SDK for placement 9873868 -->
  <script src='//libtl.com/sdk.js' data-zone='9873868' data-sdk='show_9873868'></script>

  <style>
    :root{--accent:#ffb000;--bg:#0f0f10;--card:#131313;--muted:#9b9b9b;--white:#ffffff}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:#fff;display:flex;align-items:center;justify-content:center;padding:18px}
    .frame{width:380px;border-radius:20px;background:#ffb000;box-shadow:0 6px 0 rgba(0,0,0,0.06)}
    .device{background:var(--bg);border-radius:14px;overflow:hidden;padding-bottom:22px}
    header{height:86px;padding:18px;color:#fff}
    .section-title{color:#fff;font-size:34px;margin:6px 0 8px}
    .subtitle{opacity:0.6;font-size:13px}
    .muted-card{background:var(--card);padding:18px;border-radius:8px;color:#fff}
    .small-row{display:flex;align-items:center;justify-content:space-between;margin-top:12px}
    .btn{background:#fff;color:#000;padding:8px 14px;border-radius:22px;font-weight:600;border:none;cursor:pointer}
    .clock-badge{width:40px;height:40px;border-radius:50%;background:#222;display:flex;align-items:center;justify-content:center;color:#fff}
    #ad-debug{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.8);color:#fff;font-size:12px;max-height:120px;overflow-y:auto;padding:6px 10px;font-family:monospace;z-index:9999}
  </style>
</head>
<body>
  <div class="frame">
    <div class="device">
      <header>
        <h1>Tasks</h1>
        <div class="subtitle">Get rewards for actions</div>
      </header>
      <main>
        <!-- In-App -->
        <div class="muted-card">
          <div style="font-size:22px;margin-bottom:6px">Daily</div>
          <div style="color:var(--muted);font-size:13px;margin-bottom:14px">Ads will repeat every 25s</div>
          <div class="small-row">
            <div style="display:flex;align-items:center;gap:14px">
              <div style="font-size:36px">üëÄ</div>
              <div>
                <div class="title">Watch video</div>
                <div class="meta">In-App Interstitial</div>
              </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <div class="clock-badge">‚è±</div>
              <button class="btn" id="btn-inapp">Watch</button>
              <button class="btn" id="btn-stop" style="background:#ff4444;color:#fff">Stop</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Debug -->
  <div id="ad-debug"></div>

  <script>
    const tg = window.Telegram?.WebApp || null;
    if (tg) tg.expand();

    let adInterval = null;

    function logDebug(msg){
      const div = document.getElementById('ad-debug');
      const time = new Date().toLocaleTimeString();
      div.innerHTML += `[${time}] ${msg}<br>`;
      div.scrollTop = div.scrollHeight;
    }

    function rewardUser(source){
      logDebug('Rewarding user for ' + source);
      if (tg?.MainButton){
        tg.MainButton.setText(`Reward from ${source} üéâ`);
        tg.MainButton.show();
        setTimeout(()=>tg.MainButton.hide(), 1800);
      }
    }

    async function showAd(){
      if (typeof show_9873868 !== 'function'){
        logDebug('SDK not loaded.');
        return;
      }
      try {
        logDebug('Showing ad...');
        await show_9873868({
          type: 'inApp',
          inAppSettings: { frequency:0, capping:0, interval:0, timeout:0, everyPage:false }
        });
        logDebug('Ad shown.');
        rewardUser('inApp');
      } catch(e){
        logDebug('Ad failed: ' + e);
      }
    }

    function startAdLoop(){
      if (adInterval){
        logDebug('Loop already running.');
        return;
      }
      showAd(); // show first immediately
      adInterval = setInterval(showAd, 15000); // repeat every 25s
      logDebug('Ad loop started.');
    }

    function stopAdLoop(){
      if (adInterval){
        clearInterval(adInterval);
        adInterval = null;
        logDebug('Ad loop stopped.');
      }
    }

    document.getElementById('btn-inapp').addEventListener('click', startAdLoop);
    document.getElementById('btn-stop').addEventListener('click', stopAdLoop);
  </script>
</body>
</html>
